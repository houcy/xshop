from subprocess import call as sh
import os

def run(run_function):
	run_function('target','run_exploit')
	
def run_exploit():
    try:
        cflag =os.environ['cflag']
    except KeyError:
	cflag=''

    if sh(['clang','example.c','-ljpeg',cflag]):
        return 1
		
    ret = sh(['./a.out'])
    
    if ret==0:      # Not Vulnerable
	return 0
    elif ret==77:   # MemSan
        return 0
    elif ret==2:    # Vulnerable
	return 2    
    else:           # Other Error
	return 1
